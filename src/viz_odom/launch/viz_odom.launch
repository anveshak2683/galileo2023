<launch>

  <!--<include file="$(find rplidar_ros)/launch/rplidar.launch" />-->
  
  <include file="$(find viz_odom)/launch/camera.launch" />
  
  
  <!--<node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
  		<param name="transform_publish_period" value="0" />
  	
  </node>-->
  
  <!--<node pkg="amcl" type="amcl" name="amcl_node" output="screen">
 		<param name="use_map_topic" type="bool" value="true"/>
 		<param name="tf_broadcast" type="bool" value="false"/>
  </node>-->
   
   <!--<node name="rectify" pkg="image_proc" type="image_proc" output="screen">
   
      <remap from="image_raw" to="/camera/color/image_raw"/>
      <remap from="camera_info" to="/camera/color/camera_info"/>
      
   </node>-->
   
  <node name="viz_odom" pkg="rtabmap_ros" type="rgbd_odometry" output="screen">
   
     <param name="frame_id" type="string" value="base_link"/>
     <param name="odom_frame_id" type="string" value="odom"/>
     <param name="publish_tf" type="bool" value="false"/>
     <param name="initial_pose" type="string" value="0 0 0 0 0 0"/>
     <param name="approx_sync" type="bool" value="true"/>
     <param name="subscribe_rgbd" type="bool" value="false"/>
     <param name="publish_null_when_lost" type="bool" value="true"/>
     <param name="Vis/MinInliers" value="8"/>
     <param name="Odom/FilteringStrategy" value="1"/>
     <param name="Vis/CorType" value="0"/>
     <param name="Odom/Holonomic" type="bool" value="false"/>
     <param name="max_update_rate" value="20"/>
     <param name="Rtabmap/ImagesAlreadyRectified" type="bool" value="true"/>
     <param name="Vis/MaxFeatures" value="2000"/>
     <param name="Odom/GuessMotion" type="bool" value="true"/>
     <param name="Odom/VisKeyFrameThr" value="8"/>
     <param name="OdomF2M/BundleAdjustmentMaxFrames" value="300"/>
     <param name="OdomMono/MinTranslation" value="0.0"/>
     <param name="OdomViso2/RansacIters" value="100"/>
     <param name="OdomViso2/InlierThreshold" value="0.5"/>
     <param name="Vis/RefineIterations" value="5"/>

     
     <remap from="rgb/image" to="/camera/color/image_raw" />
     <remap from="rgb/camera_info" to="/camera/color/camera_info"/>
     <remap from="depth/image" to="/camera/depth/image_rect_raw"/>
     <remap from="/odom" to="/odom_cam"/>
     <!---->
   </node>
   

  <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" args="-d">
  
     <param name="Optimizer/Iterations" type="int" value="50"/>
     <param name="Grid/Sensor" type="int" value="1" />
     <param name="approx_sync" type="bool" value="true"/>
     <param name="subscribe_scan" type="bool" value="false"/>
     <param name="subscribe_depth" type="bool" value="true"/>
     <param name="publish_tf" type="bool" value="true"/>
     <param name="subscribe_stereo"    type="bool"   value="false"/>
     <param name="initial_pose" value="0 0 0 0 0 0"/>
     <param name="Rtabmap/WithGps" type="bool" value="true"/>
     <param name="Optimizer/Robust" type="bool" value="true"/>
     <param name="RGBD/OptimizeMaxError" value="3"/>
     <param name="Grid/FromDepth" type="bool" value="true"/>
     <param name="RGBD/LocalRadius" value="20"/>
     <remap from="rgb/image" to="/camera/color/image_raw" />
     <remap from="rgb/camera_info" to="/camera/color/camera_info"/>
     <remap from="depth/image" to="/camera/depth/image_rect_raw"/>
     <remap from="/gps/fix" to="/fix"/>
     
     <!--<remap from="left_image_topic" to="/camera/infra1/image_rect_raw" />
     <remap from="right_image_topic" to="/camera/infra2/image_rect_raw" />
     <remap from="left_camera_info_topic" to="/camera/infra1/camera_info" />
     <remap from="right_camera_info_topic" to="/camera/infra2/camera_info" />-->   
   </node>

 
    <!--<node pkg="robot_localization" type="ekf_localization_node" name="ekf_global" clear_params="true">
    	<rosparam command="load" file="$(find viz_odom)/src/ekf_global.yaml" />
    	<remap from="/odometry/filtered" to="odom/global"/>
    </node>-->
   
   <node pkg="robot_localization" type="ekf_localization_node" name="ekf_local" clear_params="true">
    	<rosparam command="load" file="$(find viz_odom)/src/ekf_local.yaml" />
    	<remap from="/odometry/filtered" to="odom"/>
    </node>
   
</launch>
